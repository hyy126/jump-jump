(function(t){function i(i){for(var o,a,h=i[0],r=i[1],c=i[2],u=0,d=[];u<h.length;u++)a=h[u],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&d.push(n[a][0]),n[a]=0;for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);l&&l(i);while(d.length)d.shift()();return s.push.apply(s,c||[]),e()}function e(){for(var t,i=0;i<s.length;i++){for(var e=s[i],o=!0,h=1;h<e.length;h++){var r=e[h];0!==n[r]&&(o=!1)}o&&(s.splice(i--,1),t=a(a.s=e[0]))}return t}var o={},n={app:0},s=[];function a(i){if(o[i])return o[i].exports;var e=o[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=t,a.c=o,a.d=function(t,i,e){a.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,i){if(1&i&&(t=a(t)),8&i)return t;if(4&i&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(a.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var o in t)a.d(e,o,function(i){return t[i]}.bind(null,o));return e},a.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(i,"a",i),i},a.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},a.p="/";var h=window["webpackJsonp"]=window["webpackJsonp"]||[],r=h.push.bind(h);h.push=i,h=h.slice();for(var c=0;c<h.length;c++)i(h[c]);var l=r;s.push([0,"chunk-vendors"]),e()})({0:function(t,i,e){t.exports=e("56d7")},"034f":function(t,i,e){"use strict";var o=e("64a9"),n=e.n(o);n.a},"56d7":function(t,i,e){"use strict";e.r(i);e("cadf"),e("551c"),e("f751"),e("097d");var o=e("2b0e"),n=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("section",{staticClass:"jump-wrapper"},[e("section",{staticClass:"score-wrapper"},[t._v(t._s(t.score))]),e("canvas",{ref:"canvas",attrs:{id:"app"}})])},s=[],a={pointInPolygon:function(t,i){for(var e=t[0],o=t[1],n=!1,s=0,a=i.length-1;s<i.length;a=s++){var h=i[s][0],r=i[s][1],c=i[a][0],l=i[a][1],u=r>o!=l>o&&e<(c-h)*(o-r)/(l-r)+h;u&&(n=!n)}return n},mapUv:function(t,i,e,o,n,s,a,h,r){var c=1/t,l=1/i;if(e.faces[o]instanceof THREE.Face3){var u=e.faceVertexUvs[0][2*o];4!=o||r?(u[0].x=n*c,u[0].y=s*l,u[1].x=n*c,u[1].y=h*l,u[2].x=a*c,u[2].y=s*l):(u[0].x=n*c,u[0].y=s*l,u[2].x=n*c,u[2].y=h*l,u[1].x=a*c,u[1].y=s*l);u=e.faceVertexUvs[0][2*o+1];4!=o||r?(u[0].x=n*c,u[0].y=h*l,u[1].x=a*c,u[1].y=h*l,u[2].x=a*c,u[2].y=s*l):(u[2].x=n*c,u[2].y=h*l,u[1].x=a*c,u[1].y=h*l,u[0].x=a*c,u[0].y=s*l)}},getRandomHslColor:function(){return"hsl("+Math.round(360*Math.random())+","+Math.round(100*Math.random())+"%,"+Math.round(100*Math.random())+"%)"}},h=2.11,r={initPosition:{x:-15,y:0,z:0},headRadius:h,bodyWidth:1.8141*h,jumpResult:{HIT_NEXT_BLOCK_CENTER:1,HIT_CURRENT_BLOCK:2,GAME_OVER_NEXT_BLOCK_BACK:3,GAME_OVER_CURRENT_BLOCK_BACK:4,GAME_OVER_NEXT_BLOCK_FRONT:5,GAME_OVER_BOTH:6,HIT_NEXT_BLOCK_NORMAL:7}},c={blockHeight:8,gravity:700,colors:[16231020,16747520,9083606,2924391,40951,16760320,14209233]},l=e("d225"),u=e("b0b4"),d=window.innerHeight/window.innerWidth,y=30,p=d*y,m={bacgroundColor:"#fff",frustsize:30,frustheight:p},v={to:function(t,i,e,o,n){var s=new TWEEN.Tween(i).to(e,1e3*t).easing(o||TWEEN.Easing.Linear.None).onUpdate(function(t){for(var o in e)i[o]=t[o]});n?setTimeout(function(){s.start()},1e3*n):s.start()}},b=v,f=m.frustsize,E=m.frustheight,w=function(){function t(){Object(l["a"])(this,t),this.instance=null,this.init()}return Object(u["a"])(t,[{key:"init",value:function(){window.innerHeight,window.innerWidth;this.instance=new THREE.OrthographicCamera(-f,f,E,-E,-100,85),this.instance.position.set(-10,10,10),this.target=new THREE.Vector3(0,0,0),this.instance.lookAt(this.target)}},{key:"updatePosition",value:function(t){b.to(.5,this.instance.position,{x:t.x-10,y:t.y+10,z:t.z+10}),b.to(.5,this.target,{x:t.x,y:t.y,z:t.z})}},{key:"reset",value:function(){this.instance.position.set(-10,10,10),this.target=new THREE.Vector3(0,0,0)}}]),t}(),g=w,T=e("308d"),k=e("6bb5"),x=e("013f"),R=e("4e2b"),M=c.blockHeight,j=c.colors,H=16,O=function(){function t(i){Object(l["a"])(this,t),this.type=i||"default",this.height=M,this.width=H,this.status="stop",this.scale=1;var e=Math.floor(6*Math.random());this.color=j[e]}return Object(u["a"])(t,[{key:"update",value:function(){"shrink"==this.status&&this._shrink()}},{key:"shrink",value:function(){this.status="shrink"}},{key:"_shrink",value:function(){var t=.005,i=.55;if(this.scale-=t,this.scale=Math.max(i,this.scale),!(this.scale<=i)){this.instance.scale.y=this.scale;var e=this.height*t/2;this.instance.position.y-=e}}},{key:"rebound",value:function(){this.status="stop",this.scale=1,b.to(.5,this.instance.scale,{y:1},TWEEN.Easing.Elastic.Out),b.to(.5,this.instance.position,{y:0},TWEEN.Easing.Elastic.Out)}},{key:"getVertices",value:function(){var t=[],i={x:this.instance.position.x,z:this.instance.position.z};return t.push([i.x+this.width/2,i.z+this.width/2]),t.push([i.x+this.width/2,i.z-this.width/2]),t.push([i.x-this.width/2,i.z-this.width/2]),t.push([i.x-this.width/2,i.z+this.width/2]),t}}]),t}(),P=O,_=function(t){function i(t,e,o,n,s,a){var h;if(Object(l["a"])(this,i),h=Object(T["a"])(this,Object(k["a"])(i).call(this,"Cylinder")),h.width=s||h.width,"color"===n){var r=new THREE.MeshLambertMaterial({color:14209233}),u=new THREE.MeshLambertMaterial({color:h.color}),d=3,y=(c.blockHeight-d)/2,p=new THREE.CylinderGeometry(h.width/2,h.width/2,y,120),m=new THREE.CylinderGeometry(h.width/2,h.width/2,d,120),v=new THREE.Object3D,b=new THREE.Mesh(p,u);b.position.y=(d+y)/2,b.receiveShadow=!0,b.castShadow=!0;var f=new THREE.Mesh(m,r);f.receiveShadow=!0,f.castShadow=!0;var E=new THREE.Mesh(p,u);E.position.y=-(d+y)/2,E.receiveShadow=!0,E.castShadow=!0,v.add(b),v.add(f),v.add(E),h.instance=v,w.call(Object(x["a"])(h))}function w(){this.instance.receiveShadow=!0,this.instance.castShadow=!0,this.instance.name="block",this.instance.position.x=this.x=t,this.instance.position.y=this.y=e,this.instance.position.z=this.z=o,a&&a()}return h}return Object(R["a"])(i,t),i}(P),B=_,z=new THREE.TextureLoader,C=function(t){function i(t,e,o,n,s,h){var r;if(Object(l["a"])(this,i),r=Object(T["a"])(this,Object(k["a"])(i).call(this,"Cuboid")),r.width=s||r.width,"color"===n){var u=new THREE.MeshLambertMaterial({color:14209233}),d=new THREE.MeshLambertMaterial({color:r.color}),y=3,p=(c.blockHeight-y)/2,m=new THREE.BoxGeometry(r.width,p,r.width),v=new THREE.BoxGeometry(r.width,y,r.width),b=new THREE.Object3D,f=new THREE.Mesh(m,d);f.position.y=(y+p)/2,f.receiveShadow=!0,f.castShadow=!0;var E=new THREE.Mesh(v,u);E.receiveShadow=!0,E.castShadow=!0;var w=new THREE.Mesh(m,d);w.position.y=-(y+p)/2,w.receiveShadow=!0,w.castShadow=!0,b.add(f),b.add(E),b.add(w),r.instance=b,R.call(Object(x["a"])(r))}else if("well"===n){var g=new THREE.BoxGeometry(r.width,r.height,r.width);a.mapUv(280,428,g,1,0,0,280,148),a.mapUv(280,428,g,2,0,148,280,428),a.mapUv(280,428,g,4,0,0,280,148,!0),z.load("../../../img/well.png",function(t){var i=new THREE.MeshLambertMaterial({map:t});r.instance=new THREE.Mesh(g,i),R.call(Object(x["a"])(r))})}function R(){this.instance.receiveShadow=!0,this.instance.castShadow=!0,this.instance.name="block",this.instance.position.x=this.x=t,this.instance.position.y=this.y=e,this.instance.position.z=this.z=o,h&&h()}return r}return Object(R["a"])(i,t),i}(P),S=C,L=function(){function t(){Object(l["a"])(this,t),this.instances={},this.init()}return Object(u["a"])(t,[{key:"init",value:function(){var t=new THREE.AmbientLight(16777215,.8),i=new THREE.DirectionalLight(16777215,.3);this.shadowLight=i,i.position.set(10,30,20);var e=new THREE.MeshBasicMaterial({color:16119285});this.shadowTarget=new THREE.Mesh(new THREE.PlaneGeometry(.1,.1),e),this.shadowTarget.visible=!1,this.shadowTarget.name="shadowTarget",i.target=this.shadowTarget,i.castShadow=!0,i.shadow.camera.near=.5,i.shadow.camera.far=500,i.shadow.camera.left=-100,i.shadow.camera.right=100,i.shadow.camera.bottom=-100,i.shadow.camera.top=100,i.shadow.mapSize.width=1024,i.shadow.mapSize.height=1024,this.instances.ambientLight=t,this.instances.shadowLight=i,this.instances.shadowTarget=this.shadowTarget}},{key:"updatePosition",value:function(t){b.to(.5,this.shadowTarget.position,{x:t.x,y:t.y,z:t.z}),b.to(.5,this.shadowLight.position,{x:10+t.x,y:30+t.y,z:20+t.z})}},{key:"reset",value:function(){this.shadowLight.position.set(10,30,20),this.shadowTarget.position.set(0,0,0)}}]),t}(),N=L,D=function(){function t(){Object(l["a"])(this,t)}return Object(u["a"])(t,[{key:"init",value:function(){var t=new THREE.PlaneGeometry(200,200),i=new THREE.ShadowMaterial({color:0,opacity:.3});this.instance=new THREE.Mesh(t,i),this.instance.receiveShadow=!0,this.instance.rotation.x=-Math.PI/2,this.instance.position.y=-4.1}},{key:"updatePosition",value:function(t){this.instance.position.x=t.x,this.instance.position.z=t.z}},{key:"reset",value:function(){this.instance.position.x=0,this.instance.position.z=0}}]),t}(),G=new D,I=m.frustsize,A=m.frustheight,K=function(){function t(){Object(l["a"])(this,t)}return Object(u["a"])(t,[{key:"init",value:function(){var t=new THREE.PlaneGeometry(2*I,2*A),i=new THREE.MeshBasicMaterial({color:14146534});this.instance=new THREE.Mesh(t,i)}}]),t}(),F=new K,V=(e("ac6a"),{audioSources:{init:"../../../audios/init.mp3",shrink:"../../../audios/shrink.mp3",shrink_end:"../../../audios/shrink_end.mp3",fall:"../../../audios/fall.mp3",fall_from_block:"../../../audios/fall_from_block.mp3",combo1:"../../../audios/combo1.mp3",combo2:"../../../audios/combo2.mp3",combo3:"../../../audios/combo3.mp3",combo4:"../../../audios/combo4.mp3",combo5:"../../../audios/combo5.mp3",combo6:"../../../audios/combo6.mp3",combo7:"../../../audios/combo7.mp3",combo8:"../../../audios/combo8.mp3",success:"../../../audios/success.mp3"}}),U=!1,W={},X=V.audioSources;if(U)for(var Y in X){var q=X[Y],$=new Audio(q);W[Y]=$,"shrink"==Y&&(W["shrink"].onended=function(){W["shrink_end"].play()}),"shrink_end"===Y&&($.loop=!0)}W.play=function(t,i){U&&W[t][i]()};var J=W,Q=c.blockHeight,Z=r.initPosition,tt=r.headRadius,it=function(){function t(){Object(l["a"])(this,t),this.axis=null,this.hit=null,this.status="stop",this.scaleY=1,this.direction=0,this.flyingTime=0,this.velocity={vx:0,vy:0},this.isGatherParticle=!1}return Object(u["a"])(t,[{key:"init",value:function(){this.obj=new THREE.Object3D,this.obj.position.set(Z.x,Z.y+30,Z.z),this.obj.name="bottle",this.bottle=new THREE.Object3D,this.human=new THREE.Object3D,this.body=new THREE.Object3D,this.loadTexture(),this.initHead(),this.initBottom(),this.initMiddle(),this.initBodyHeader(),this.human.add(this.head),this.human.add(this.body),this.bottle.add(this.human),this.bottle.position.y=2,this.obj.add(this.bottle),this.initParticle()}},{key:"resetParticle",value:function(){var t=this;this.cachePoint.forEach(function(i){var e=t.initRandomPoint();i.x=e.x,i.y=e.y,i.z=e.z})}},{key:"gatherParticle",value:function(){var t=this,i=-1,e=this,o=setInterval(function(){!1===t.isGatherParticle&&(clearInterval(o),o=null),14===i&&(e.resetParticle(),i=-1),i++,e.cachePoint[i].x=e.cachePoint[i].cache.x,e.cachePoint[i].y=e.cachePoint[i].cache.y,e.cachePoint[i].z=e.cachePoint[i].cache.z,b.to(Math.random()/4+.3,e.cachePoint[i],{x:0,y:0,z:0})},100)}},{key:"initRandomPoint",value:function(){var t=10,i=15,e=new THREE.Vector3,o=(t+Math.random()*(i-t))*(1-2*Math.random()),n=(t+Math.random()*(i-t))*(1-2*Math.random()),s=2;return e.x=0,e.y=0,e.z=0,e.cache={x:o,y:s,z:n},e}},{key:"initParticle",value:function(){this.whitegeometry=new THREE.Geometry,this.greengeometry=new THREE.Geometry,this.cachePoint=[];for(var t=0;t<15;t++){var i=this.initRandomPoint();this.cachePoint.push(i),t%2===0?this.greengeometry.vertices.push(i):this.whitegeometry.vertices.push(i)}var e=new THREE.PointsMaterial({color:16777215,size:5}),o=new THREE.PointsMaterial({color:10157978,size:5});this.whitegeometrypoints=new THREE.Points(this.whitegeometry,e),this.greengeometrypoints=new THREE.Points(this.greengeometry,o),this.whitegeometrypoints.visible=!1,this.whitegeometrypoints.visible=!1,this.obj.add(this.whitegeometrypoints),this.obj.add(this.greengeometrypoints)}},{key:"setDirection",value:function(t,i){this.direction=t,this.axis=i}},{key:"initHead",value:function(){this.head=new THREE.Mesh(new THREE.OctahedronGeometry(tt),this.material.bottomMaterial),this.head.position.y=8.8}},{key:"initBottom",value:function(){var t=new THREE.Mesh(new THREE.CylinderGeometry(.62857*tt,.907143*tt,1.91423*tt,20),this.material.bottomMaterial);t.castShadow=!0,this.body.add(t)}},{key:"initMiddle",value:function(){var t=new THREE.Mesh(new THREE.CylinderGeometry(tt/1.4,tt/1.44*.88,1.2*tt,20),this.material.middleMaterial);t.castShadow=!0,t.position.y=3,this.body.add(t)}},{key:"initBodyHeader",value:function(){var t=new THREE.SphereGeometry(tt/1.4,20,20);t.scale(1,.54,1);var i=new THREE.Mesh(t,this.material.specularMaterial);i.castShadow=!0,i.position.y=2.1*tt,this.body.add(i)}},{key:"loadTexture",value:function(){var t=new THREE.TextureLoader,i=t.load("/img/head.png"),e=new THREE.MeshBasicMaterial({map:i}),o=t.load("/img/bottom.png"),n=new THREE.MeshBasicMaterial({map:o}),s=t.load("/img/middle.png"),a=new THREE.MeshBasicMaterial({map:s});this.material={specularMaterial:e,bottomMaterial:n,middleMaterial:a}}},{key:"shrink",value:function(){this.whitegeometrypoints.visible=!0,this.whitegeometrypoints.visible=!0,this.status="shrink",this.gatherParticle(),this.isGatherParticle=!0}},{key:"jump",value:function(){this.whitegeometrypoints.visible=!1,this.whitegeometrypoints.visible=!1,this.isGatherParticle=!1,this.resetParticle(),this.status="jump",this.translateH=0,this.translateY=0}},{key:"stop",value:function(){this.status="stop",this.flyingTime=0,this.scaleY=1}},{key:"_shrink",value:function(){var t=.55,i=.007,e=.005,o=.03;if(this.scaleY-=e,this.scaleY=Math.max(t,this.scaleY),!(this.scaleY<=t)){this.body.scale.y=this.scaleY,this.body.scale.x+=i,this.body.scale.z+=i,this.head.position.y-=o;var n=o/2,s=c.blockHeight*e;this.obj.position.y-=n+s}}},{key:"_jump",value:function(t){var i=t/1e3,e=this.velocity.vx*i,o=this.velocity.vy*i-.5*c.gravity*i*i-c.gravity*this.flyingTime*i;this.translateH+=e,this.translateY+=o,this.obj.translateY(o),this.obj.translateOnAxis(this.axis,e),this.flyingTime+=i}},{key:"update",value:function(){if("shrink"===this.status)this._shrink();else if("jump"===this.status){var t=Date.now()-this.lastFrameTime;this._jump(t)}this.head.rotation.y+=.03,this.lastFrameTime=Date.now()}},{key:"straight",value:function(){var t=this;this.status="straight",setTimeout(function(){b.to(.4,t.obj.position,{y:-c.blockHeight/2+.5})})}},{key:"hypsokinesis",value:function(){var t=this;this.status="hypsokinesis",setTimeout(function(){0==t.direction?b.to(.8,t.obj.rotation,{z:Math.PI/2}):b.to(.8,t.obj.rotation,{x:Math.PI/2}),setTimeout(function(){b.to(.4,t.obj.position,{y:-c.blockHeight/2+1.2}),b.to(.2,t.head.position,{x:1.125}),b.to(.2,t.head.position,{x:0},null,.2)},350)},200)}},{key:"forerake",value:function(){var t=this;this.status="forerake",setTimeout(function(){0==t.direction?b.to(1,t.obj.rotation,{z:-Math.PI/2}):b.to(1,t.obj.rotation,{x:-Math.PI/2}),setTimeout(function(){b.to(.4,t.obj.position,{y:-c.blockHeight/2+.5})},350)},200)}},{key:"reset",value:function(){this.stop(),this.obj.rotation.x=0,this.obj.rotation.z=0,this.obj.position.set(Z.x,Z.y+30,Z.z)}},{key:"initDown",value:function(){var t=this;new TWEEN.Tween(this.obj.position).to({x:Z.x,y:Z.y+Q/2,z:Z.z},1e3).easing(TWEEN.Easing.Bounce.Out).onUpdate(function(i){t.obj.position.set(i.x,i.y,i.z)}).start();J.play("init","play")}},{key:"rotate",value:function(){var t=1.4;this.human.rotation.x=this.human.rotation.z=0,0==this.direction?(b.to(.14,this.human.rotation,{z:this.human.rotation.z-Math.PI}),b.to(.18,this.human.rotation,{z:this.human.rotation.z-2*Math.PI},void 0,.14),b.to(.1,this.head.position,{y:this.head.position.y+.9*t,x:this.head.position.x+.45*t}),b.to(.1,this.head.position,{y:this.head.position.y-.9*t,x:this.head.position.x-.45*t},void 0,.1),b.to(.15,this.head.position,{y:8.8,x:0},void 0,.25),b.to(.1,this.body.scale,{y:Math.max(t,1),x:Math.max(Math.min(1/t,1),.7),z:Math.max(Math.min(1/t,1),.7)}),b.to(.1,this.body.scale,{y:Math.min(.9/t,.7),x:Math.max(t,1.2),z:Math.max(t,1.2)},void 0,.1),b.to(.3,this.body.scale,{y:1,x:1,z:1},void 0,.2)):1==this.direction&&(b.to(.14,this.human.rotation,{x:this.human.rotation.x-Math.PI}),b.to(.18,this.human.rotation,{x:this.human.rotation.x-2*Math.PI},void 0,.14),b.to(.1,this.head.position,{y:this.head.position.y+.9*t,z:this.head.position.z-.45*t}),b.to(.1,this.head.position,{z:this.head.position.z+.45*t,y:this.head.position.y-.9*t},void 0,.1),b.to(.15,this.head.position,{y:8.8,z:0},void 0,.25),b.to(.05,this.body.scale,{y:Math.max(t,1),x:Math.max(Math.min(1/t,1),.7),z:Math.max(Math.min(1/t,1),.7)}),b.to(.05,this.body.scale,{y:Math.min(.9/t,.7),x:Math.max(t,1.2),z:Math.max(t,1.2)},void 0,.1),b.to(.2,this.body.scale,{y:1,x:1,z:1},void 0,.2))}}]),t}(),et=new it;function ot(){this.handlers={}}ot.prototype={on:function(t,i){var e=this;return t in e.handlers||(e.handlers[t]=[]),e.handlers[t].push(i),this},emit:function(t){for(var i=this,e=Array.prototype.slice.call(arguments,1),o=0;o<i.handlers[t].length;o++)i.handlers[t][o].apply(i,e);return i},off:function(t,i){var e=this.handlers[t],o=0;if(e){o=e.length;for(var n=o-1;n>=0;n--)e[n]===i&&e.splice(n,1)}return this}};var nt,st,at=new ot,ht=function(){function t(){Object(l["a"])(this,t),this.cellTailConfig={duration:200,height:2,width:.5,distance:.5},this.distance=this.cellTailConfig.distance,this.tailsRemainPool=[],this.tailsUsingPool=[]}return Object(u["a"])(t,[{key:"init",value:function(t,i){this.scene=t,this.bottle=i,this.lastDotPosition=this.bottle.obj.position.clone(),this.nowPosition=this.bottle.obj.position.clone();var e=this.cellTailConfig.width,o=this.cellTailConfig.height;this.geometry=new THREE.PlaneGeometry(e,o),this.material=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,transparent:!0,opacity:.3});for(var n=0;n<20;n++){var s=new rt(this.geometry,this.material);this.scene.add(s.mesh),this.tailsRemainPool.push(s)}}},{key:"update",value:function(t){if(this.updateActiveCell(t),"shrink"==this.bottle.status&&(this.nowPosition=this.bottle.obj.position.clone(),this.lastDotPosition=this.bottle.obj.position.clone()),"jump"==this.bottle.status){var i=void 0;if(this.nowPosition=this.bottle.obj.position.clone(),i=this.nowPosition.clone().distanceTo(this.lastDotPosition.clone()),i<5){if(i>=this.distance)for(var e=i/this.distance,o=Math.floor(e),n=this.lastDotPosition.clone(),s=this.nowPosition.clone(),a=t/this.cellTailConfig.duration,h=1;h<=o;h++){s=this.lastDotPosition.clone().lerp(this.nowPosition.clone(),h/e);var r=1+a*(h/e-1);r=r<=0?0:r,this.layEgg(n.clone(),s.clone(),r),n=s.clone(),h==o&&(this.lastDotPosition=s.clone())}}else this.lastDotPosition=this.nowPosition.clone()}}},{key:"correctPosition",value:function(){this.lastDotPosition=this.bottle.obj.position.clone()}},{key:"updateActiveCell",value:function(t){for(var i=this.tailsUsingPool,e=1/this.cellTailConfig.duration,o=(this.cellTailConfig.duration,0);o<i.length;o++){i[o].tickTime+=t;var n=i[o].mesh.scale.y-e*t;n>0?(i[o].mesh.scale.y=n>0?n:0,i[o].tickTime>=this.cellTailConfig.duration&&s.call(this)):s.call(this)}function s(){i[o].reset();var t=i.shift();this.tailsRemainPool.push(t),o--}}},{key:"layEgg",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=this.getMesh();this.tailsUsingPool.push(o),o.mesh.position.set(i.x,i.y,i.z),o.mesh.scale.y=e,o.mesh.lookAt(t),o.mesh.rotateY(Math.PI/2),o.mesh.visible=!0}},{key:"getMesh",value:function(){var t=this.tailsRemainPool.shift();return t||(t=new rt(this.geometry,this.material),this.scene.add(t.mesh)),t}}]),t}(),rt=function(){function t(i,e){Object(l["a"])(this,t),this.tickTime=0,this.mesh=new THREE.Mesh(i,e),this.mesh.visible=!1,this.mesh.name="tail"}return Object(u["a"])(t,[{key:"reset",value:function(){this.tickTime=0,this.mesh.scale.set(1,1,1),this.mesh.visible=!1}}]),t}(),ct=new ht,lt=function(){function t(i){Object(l["a"])(this,t),this.instance=null,this.currentBlock=null,this.targetBlock=null,this.checkingHit=!1,this.axis=null,this.combo=0,this.init(i),this.now=Date.now(),this.lastFrameTime=Date.now()}return Object(u["a"])(t,[{key:"init",value:function(t){this.instance=new THREE.Scene,this.renderer=new THREE.WebGLRenderer({antialias:!0,canvas:t,preserveDrawingBuffer:!0}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFShadowMap,this.camera=new g,this.instance.add(this.camera.instance),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(t.offsetWidth,t.offsetHeight),this.initLight(),this.addGround(),this.initBacground(),this.initBottle(),this.addInitBlock(),this.tailSystem=ct,this.tailSystem.init(this.instance,this.bottle),this.render()}},{key:"initBottle",value:function(){this.bottle=et,this.bottle.init(),this.instance.add(this.bottle.obj),this.bottle.initDown()}},{key:"addGround",value:function(){this.ground=G,G.init(),this.instance.add(G.instance)}},{key:"initBacground",value:function(){this.background=F,F.init(),F.instance.position.z=-84,this.camera.instance.add(F.instance)}},{key:"initLight",value:function(){for(var t in this.light=new N,this.light.instances)this.instance.add(this.light.instances[t])}},{key:"addInitBlock",value:function(){var t=this,i=new S(-15,0,0,"well",16,function(){t.instance.add(i.instance)}),e=new B(23,0,0,"color");this.currentBlock=i,this.targetBlock=e,this.instance.add(e.instance),this.setDirection(0)}},{key:"setDirection",value:function(t){var i={x:this.bottle.obj.position.x,z:this.bottle.obj.position.z};this.axis=new THREE.Vector3(this.targetBlock.x-i.x,0,this.targetBlock.z-i.z),this.axis.normalize(),this.bottle.setDirection(t,this.axis)}},{key:"addControl",value:function(){new THREE.OrbitControls(this.camera.instance,this.renderer.domElement)}},{key:"updateNextBlock",value:function(){var t=Math.round(Math.random()),i=t?"cuboid":"cylinder",e=Math.round(Math.random()),o=Math.round(12*Math.random())+8,n=Math.round(20*Math.random())+20;this.currentBlock=this.targetBlock;var s=this.targetPosition={};s.y=this.targetBlock.instance.position.y,0==e?(s.x=this.currentBlock.instance.position.x+n,s.z=this.currentBlock.instance.position.z):1==e&&(s.x=this.currentBlock.instance.position.x,s.z=this.currentBlock.instance.position.z-n),this.targetBlock="cuboid"==i?new S(s.x,s.y,s.z,"color",o):new B(s.x,s.y,s.z,"color",o),this.instance.add(this.targetBlock.instance),this.setDirection(e);var a={x:(this.currentBlock.instance.position.x+this.targetBlock.instance.position.x)/2,y:(this.currentBlock.instance.position.y+this.targetBlock.instance.position.y)/2,z:(this.currentBlock.instance.position.z+this.targetBlock.instance.position.z)/2};this.updateCameraPosition(a),this.ground.updatePosition(a)}},{key:"updateCameraPosition",value:function(t){this.camera.updatePosition(t),this.light.updatePosition(t)}},{key:"updateScoreEvent",value:function(t){at.emit("scorechange",t)}},{key:"checkBottleHit",value:function(){var t=this;if(this.bottle.obj.position.y<=c.blockHeight/2&&"jump"===this.bottle.status&&this.bottle.flyingTime>.3)if(this.checkingHit=!1,this.bottle.hit==r.jumpResult.HIT_NEXT_BLOCK_CENTER||this.bottle.hit==r.jumpResult.HIT_NEXT_BLOCK_NORMAL||this.bottle.hit==r.jumpResult.HIT_CURRENT_BLOCK){if(this.bottle.stop(),this.bottle.obj.position.y=c.blockHeight/2,this.bottle.obj.position.x=this.bottle.destination[0],this.bottle.obj.position.z=this.bottle.destination[1],this.bottle.hit!==r.jumpResult.HIT_CURRENT_BLOCK){var i=1;if(this.bottle.hit===r.jumpResult.HIT_NEXT_BLOCK_CENTER){this.combo++,i=2*this.combo;var e=this.combo>8?8:this.combo;J.play("combo"+e,"play")}else this.combo=0,J.play("success","play");this.updateScoreEvent(i),this.updateNextBlock()}}else{var o=function(){J.play("fall_from_block","play"),t.bottle.obj.position.y=c.blockHeight/2,setTimeout(function(){n()},1500)},n=function(){alert("游戏结束"),t.restart(),t.updateScoreEvent(0)};this.bottle.stop(),this.combo=0,this.bottle.hit===r.jumpResult.GAME_OVER_NEXT_BLOCK_BACK||this.bottle.hit===r.jumpResult.GAME_OVER_CURRENT_BLOCK_BACK?(this.bottle.forerake(),o()):this.bottle.hit===r.jumpResult.GAME_OVER_NEXT_BLOCK_FRONT?(this.bottle.hypsokinesis(),o()):(this.bottle.straight(),J.play("fall","play"),this.bottle.obj.position.y=c.blockHeight/2,setTimeout(function(){n()},1500))}}},{key:"restart",value:function(){this.deleteObjectsfromScene(),this.camera.reset(),this.light.reset(),this.bottle.reset(),this.ground.reset(),this.addInitBlock(),this.addGround(),this.initBottle()}},{key:"deleteObjectsfromScene",value:function(){var t=this.instance.getObjectByName("block");while(t)this.instance.remove(t),t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose(),t=this.instance.getObjectByName("block");this.instance.remove(this.bottle.obj),this.instance.remove(this.ground.instance)}},{key:"render",value:function(t){this.now=Date.now();var i=this.now-this.lastFrameTime;this.bottle.update(),this.currentBlock&&this.currentBlock.update(),this.checkingHit&&this.checkBottleHit(),this.tailSystem&&this.tailSystem.update(i),this.renderer.render(this.instance,this.camera.instance),TWEEN.update(t),this.stats&&this.stats.update(),this.lastFrameTime=Date.now(),this.bottle.isGatherParticle&&(this.bottle.whitegeometry.verticesNeedUpdate=!0,this.bottle.greengeometry.verticesNeedUpdate=!0),requestAnimationFrame(this.render.bind(this))}}]),t}(),ut=lt,dt=null,yt={data:function(){return{score:0,keyTouch:32,isKeyDown:!1}},methods:{init:function(){},animate:function(){requestAnimationFrame(this.animate),this.render(),dt.update()},initstats:function(){dt=new Stats,dt.domElement.style.position="absolute",dt.domElement.style.left="0px",dt.domElement.style.top="0px",document.body.appendChild(dt.domElement),st.stats=dt},bindTouchEvent:function(){var t=this;nt.addEventListener("touchstart",this.touchstart),nt.addEventListener("touchend",this.touchend),document.onkeydown=function(i){i.keyCode!==t.keyTouch||t.isKeyDown||(t.isKeyDown=!0,t.touchstart())},document.onkeyup=function(i){i.keyCode===t.keyTouch&&(t.isKeyDown=!1,t.touchend())}},checkRight:function(){var t=st.bottle.status;if("jump"===t)return!0},touchstart:function(){this.checkRight()||(J.play("success","load"),J.play("shrink","play"),this.touchStartTime=Date.now(),st.bottle.shrink(),st.currentBlock.shrink())},touchend:function(){if(!this.checkRight()){J.play("shrink","load"),J.play("shrink_end","load"),this.touchEndTime=Date.now();var t=this.touchEndTime-this.touchStartTime,i=st.bottle;i.velocity.vx=Math.min(t/6,400),i.velocity.vx=+i.velocity.vx.toFixed(2),i.velocity.vy=Math.min(150+t/20,400),i.velocity.vy=+i.velocity.vy.toFixed(2),i.stop();var e=(1-st.currentBlock.instance.scale.y)*c.blockHeight;st.bottle.hit=this.getHitStatus(i,st.currentBlock,st.targetBlock,e),st.checkingHit=!0,st.currentBlock.rebound(),i.rotate(),i.jump()}},getHitStatus:function(t,i,e,o){var n=parseFloat(t.velocity.vy)/parseFloat(c.gravity)*2;o=o||t.obj.position.y.toFixed(2);var s=+((t.velocity.vy-Math.sqrt(Math.pow(t.velocity.vy,2)-2*o*c.gravity))/c.gravity).toFixed(2);n-=s,n=+n.toFixed(2);var h,l,u=[],d=new THREE.Vector2(t.obj.position.x,t.obj.position.z),y=new THREE.Vector2(st.axis.x,st.axis.z).setLength(t.velocity.vx*n);if(d.add(y),t.destination=[+d.x.toFixed(2),+d.y.toFixed(2)],u.push(+d.x.toFixed(2),+d.y.toFixed(2)),e){var p=Math.pow(u[0]-e.instance.position.x,2)+Math.pow(u[1]-e.instance.position.z,2),m=e.getVertices();a.pointInPolygon(u,m)?h=Math.abs(p)<5?r.jumpResult.HIT_NEXT_BLOCK_CENTER:r.jumpResult.HIT_NEXT_BLOCK_NORMAL:a.pointInPolygon([u[0]-r.bodyWidth/2,u[1]],m)||a.pointInPolygon([u[0],u[1]+r.bodyWidth/2],m)?h=r.jumpResult.GAME_OVER_NEXT_BLOCK_BACK:(a.pointInPolygon([u[0]+r.bodyWidth/2,u[1]],m)||a.pointInPolygon([u[0],u[1]-r.bodyWidth/2],m))&&(h=r.jumpResult.GAME_OVER_NEXT_BLOCK_FRONT)}if(i){var v=i.getVertices();a.pointInPolygon(u,v)?l=r.jumpResult.HIT_CURRENT_BLOCK:(a.pointInPolygon([u[0]-r.bodyWidth/2,u[1]],v)||a.pointInPolygon([u[0],u[1]+r.bodyWidth/2],v))&&(h&&(l=r.jumpResult.GAME_OVER_BOTH),l=r.jumpResult.GAME_OVER_CURRENT_BLOCK_BACK)}return h||l||0},removeTouchEvent:function(){nt.removeEventListener("touchstart",this.touchstart),nt.removeEventListener("touchend",this.touchend)},initScoreEvent:function(){var t=this;at.on("scorechange",function(i){t.score=0===i?0:t.score+i})}},mounted:function(){nt=this.$refs["canvas"],st=new ut(nt),this.bindTouchEvent(),this.initstats(),this.initScoreEvent()},destroyed:function(){this.removeTouchEvent()}},pt=yt,mt=(e("034f"),e("2877")),vt=Object(mt["a"])(pt,n,s,!1,null,null,null),bt=vt.exports,ft=(e("7371"),e("22b5")),Et=e("3191");window.TWEEN=ft["a"],window.Stats=Et,o["a"].config.productionTip=!1,new o["a"]({render:function(t){return t(bt)}}).$mount("#app")},"64a9":function(t,i,e){},7371:function(t,i,e){}});
//# sourceMappingURL=app.320be97f.js.map